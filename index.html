<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Dashboard - Saunamo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #f5f7fa;
            color: #2d3748;
            line-height: 1.6;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .header h1 {
            font-size: 2rem;
            font-weight: 700;
        }

        .header-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: white;
            color: #667eea;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255,255,255,0.3);
        }

        .btn-secondary {
            background: rgba(255,255,255,0.2);
            color: white;
            backdrop-filter: blur(10px);
        }

        .btn-secondary:hover {
            background: rgba(255,255,255,0.3);
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.85rem;
        }

        .btn-warning {
            background: #ed8936;
            color: white;
        }

        .btn-warning:hover {
            background: #dd6b20;
        }

        .btn-danger {
            background: #f56565;
            color: white;
        }

        .btn-danger:hover {
            background: #e53e3e;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        /* Stats Overview */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border-left: 4px solid #667eea;
        }

        .stat-card.success { border-left-color: #48bb78; }
        .stat-card.warning { border-left-color: #ed8936; }
        .stat-card.info { border-left-color: #4299e1; }

        .stat-label {
            font-size: 0.9rem;
            color: #718096;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #2d3748;
        }

        .stat-description {
            font-size: 0.85rem;
            color: #a0aec0;
            margin-top: 5px;
        }

        /* Project Cards */
        .project-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 20px;
            overflow: hidden;
        }

        .project-header {
            padding: 25px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s;
        }

        .project-header:hover {
            background: #f7fafc;
        }

        .project-title-section {
            flex: 1;
        }

        .project-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 8px;
        }

        .project-meta {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            font-size: 0.9rem;
            color: #718096;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .status-completed {
            background: #c6f6d5;
            color: #22543d;
        }

        .status-active {
            background: #bee3f8;
            color: #2c5282;
        }

        .status-pending {
            background: #fed7d7;
            color: #742a2a;
        }

        .expand-icon {
            font-size: 1.5rem;
            transition: transform 0.3s;
            color: #a0aec0;
        }

        .project-card.expanded .expand-icon {
            transform: rotate(180deg);
        }

        .project-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .project-card.expanded .project-content {
            max-height: 10000px;
        }

        .project-details {
            padding: 0 25px 25px 25px;
            border-top: 1px solid #e2e8f0;
        }

        .section {
            margin-top: 25px;
        }

        .section-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .category-group {
            background: #f7fafc;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .category-title {
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 10px;
            font-size: 1.05rem;
        }

        .task-list {
            list-style: none;
            margin: 10px 0;
        }

        .task-list li {
            padding: 8px 0 8px 25px;
            position: relative;
            color: #4a5568;
        }

        .task-list li:before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #48bb78;
            font-weight: bold;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .metric-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .metric-label {
            font-size: 0.85rem;
            color: #718096;
            margin-bottom: 5px;
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #667eea;
        }

        /* Task Management */
        .task-item {
            background: #f7fafc;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 12px;
            border-left: 3px solid #cbd5e0;
        }

        .task-item.priority-high { border-left-color: #f56565; }
        .task-item.priority-medium { border-left-color: #ed8936; }
        .task-item.priority-low { border-left-color: #48bb78; }

        .task-item-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 8px;
        }

        .task-item-title {
            font-weight: 600;
            color: #2d3748;
            font-size: 1.05rem;
        }

        .task-item-meta {
            font-size: 0.85rem;
            color: #718096;
            margin-bottom: 8px;
        }

        .task-item-description {
            color: #4a5568;
            font-size: 0.95rem;
        }

        .task-actions {
            display: flex;
            gap: 8px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal-header {
            padding: 25px;
            border-bottom: 1px solid #e2e8f0;
        }

        .modal-header h2 {
            font-size: 1.5rem;
            color: #2d3748;
        }

        .modal-body {
            padding: 25px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 15px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .modal-footer {
            padding: 20px 25px;
            border-top: 1px solid #e2e8f0;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #a0aec0;
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.5rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .project-header {
                flex-direction: column;
                align-items: start;
            }

            .expand-icon {
                align-self: flex-end;
            }

            .task-actions {
                flex-direction: column;
                width: 100%;
            }

            .task-actions .btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div>
                <h1>üöÄ Project Dashboard</h1>
                <p style="opacity: 0.9; margin-top: 5px;">Development & Automation Projects</p>
            </div>
            <div class="header-actions">
                <button class="btn btn-primary" onclick="openTaskModal()">‚ûï Add Task</button>
                <button class="btn btn-secondary" onclick="exportAllTasks()">üì• Export All</button>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Stats Overview -->
        <div class="stats-grid">
            <div class="stat-card success">
                <div class="stat-label">Active Projects</div>
                <div class="stat-value" id="activeProjects">0</div>
                <div class="stat-description">Currently running</div>
            </div>
            <div class="stat-card info">
                <div class="stat-label">Completed Projects</div>
                <div class="stat-value" id="completedProjects">2</div>
                <div class="stat-description">Production ready</div>
            </div>
            <div class="stat-card warning">
                <div class="stat-label">Pending Tasks</div>
                <div class="stat-value" id="pendingTasks">0</div>
                <div class="stat-description">Across all projects</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Total Hours</div>
                <div class="stat-value">60+</div>
                <div class="stat-description">Development time</div>
            </div>
        </div>

        <!-- Projects -->
        <div id="projectsContainer"></div>
    </div>

    <!-- Add/Edit Task Modal -->
    <div id="taskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Add New Task</h2>
            </div>
            <form id="taskForm">
                <div class="modal-body">
                    <input type="hidden" id="taskId">
                    <input type="hidden" id="taskIndex">
                    
                    <div class="form-group">
                        <label for="taskProject">Project *</label>
                        <select id="taskProject" required>
                            <option value="pipedrive-katana">Pipedrive-Katana Automation</option>
                            <option value="seo-performance">SEO & Performance Optimization</option>
                            <option value="general">General / Other</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="taskTitle">Task Title *</label>
                        <input type="text" id="taskTitle" placeholder="e.g., Add order update functionality" required>
                    </div>

                    <div class="form-group">
                        <label for="taskDescription">Description *</label>
                        <textarea id="taskDescription" placeholder="Provide details about what needs to be done..." required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="taskPriority">Priority *</label>
                        <select id="taskPriority" required>
                            <option value="high">üî¥ High - Urgent/Critical</option>
                            <option value="medium" selected>üü° Medium - Important</option>
                            <option value="low">üü¢ Low - Nice to have</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="taskCategory">Category</label>
                        <select id="taskCategory">
                            <option value="feature">‚ú® New Feature</option>
                            <option value="bug">üêõ Bug Fix</option>
                            <option value="improvement">üîß Improvement</option>
                            <option value="documentation">üìö Documentation</option>
                            <option value="question">‚ùì Question</option>
                            <option value="other">üìã Other</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="taskAssignee">Your Name (optional)</label>
                        <input type="text" id="taskAssignee" placeholder="e.g., John Smith">
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeTaskModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="submitBtn">Add Task</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Data structure for projects
        const projects = {
            'pipedrive-katana': {
                id: 'pipedrive-katana',
                title: 'Pipedrive-Katana Automation',
                status: 'completed',
                startDate: 'Jan 2026',
                completionDate: 'Feb 2026',
                url: 'https://zesty-palmier-99854d.netlify.app',
                description: 'Automated sales order sync from Pipedrive CRM to Katana MRP',
                metrics: {
                    'Time Saved': '15-20 min/order',
                    'Accuracy': '100%',
                    'Issues Resolved': '8',
                    'Dev Hours': '40+'
                },
                categories: [
                    {
                        title: '1. Infrastructure & Deployment',
                        tasks: [
                            'Created and configured Netlify site connected to GitHub',
                            'Deployed serverless functions (JavaScript) for optimal compatibility',
                            'Configured environment variables for API security',
                            'Set up automatic deployments on git push',
                            'Created health check endpoint for monitoring',
                            'Configured Zapier trigger on Pipedrive "Deal Won" status'
                        ]
                    },
                    {
                        title: '2. Complex Discount System',
                        tasks: [
                            'Implemented discount type detection (amount vs percentage)',
                            'Built amount-to-percentage conversion logic',
                            'Created compound discount calculator (line + deal level)',
                            'Applied discounts directly to unit prices',
                            'Handled 100% discounts (free items) correctly',
                            'Tested with real orders: discounts match Pipedrive exactly'
                        ]
                    },
                    {
                        title: '3. VAT/Tax Rate System',
                        tasks: [
                            'Implemented explicit null/undefined checks',
                            'Properly handles 0% VAT as valid rate',
                            'Maps Pipedrive tax rates to Katana tax rate IDs',
                            'Supports mixed VAT rates in single order',
                            'Tested with 0%, 20%, and 23% VAT rates'
                        ]
                    },
                    {
                        title: '4. SKU Management & Product Matching',
                        tasks: [
                            'Built 3-tier SKU extraction logic',
                            'Created fix_fr_it_product_skus.py script',
                            'Processed ALL FR/IT products in Pipedrive database',
                            'Extracted SKUs from product names',
                            'Updated dedicated SKU fields systematically',
                            'Implemented automatic product creation for new SKUs'
                        ]
                    },
                    {
                        title: '5. Duplicate Product Prevention',
                        tasks: [
                            'Identified pagination issue in variant lookup',
                            'Implemented direct SKU filter in Katana API',
                            'Fixed product creation flow (product + variant in single call)',
                            'Deleted 10 duplicate products created during debugging',
                            'Verified: No duplicates created in testing'
                        ]
                    },
                    {
                        title: '6. Data Mapping & Order Creation',
                        tasks: [
                            'Customer name extraction (organization or person)',
                            'Customer email lookup and mapping',
                            'Order currency mapping (GBP, EUR, USD, etc.)',
                            'Expected delivery date from Pipedrive',
                            'Order creation timestamp (deal won time)',
                            'Order notes with Pipedrive deal reference'
                        ]
                    },
                    {
                        title: '7. Testing & Quality Assurance',
                        tasks: [
                            'Jeremy Hirsch order (LED strips, 100% discount)',
                            'Berger Patric order (FR products, mixed discounts)',
                            'Various test orders with different discount combinations',
                            '0% VAT products - verified correct',
                            'New SKU creation - working without duplicates',
                            'All order totals verified to match Pipedrive exactly'
                        ]
                    },
                    {
                        title: '8. Error Resolution',
                        tasks: [
                            'Fixed Netlify 404 errors',
                            'Fixed Zapier JSON parsing errors',
                            'Fixed Katana API: "source field not supported"',
                            'Fixed Katana API: "invalid variant"',
                            'Fixed Katana API: "discount exceeds total"',
                            'Fixed 0% VAT defaulting to 23%',
                            'Fixed duplicate product creation bug',
                            'Fixed LED strips pricing error'
                        ]
                    }
                ],
                technicalDetails: [
                    { label: 'Platform', value: 'Netlify Serverless' },
                    { label: 'Runtime', value: 'Node.js (JavaScript)' },
                    { label: 'Trigger', value: 'Zapier Webhooks' },
                    { label: 'APIs', value: 'Pipedrive + Katana' },
                    { label: 'Version Control', value: 'GitHub' },
                    { label: 'Functions', value: '600+ lines of code' }
                ]
            },
            'seo-performance': {
                id: 'seo-performance',
                title: 'SEO & Performance Optimization',
                status: 'completed',
                startDate: 'Jan 2026',
                completionDate: 'Feb 2026',
                url: 'https://www.saunamo.co.uk',
                description: 'Comprehensive SEO and performance improvements for Saunamo website',
                metrics: {
                    'Performance Score': '53 ‚Üí 65-75',
                    'LCP Improvement': '2.6s ‚Üí 2.3s',
                    'Payload Reduction': '~2MB saved',
                    'Dev Hours': '20+'
                },
                categories: [
                    {
                        title: '1. Meta Descriptions & SEO',
                        tasks: [
                            'Fixed 6 duplicate meta descriptions via API',
                            'Created unique descriptions for all Harvia Aava heaters',
                            'Created unique descriptions for Harvia Kajo heaters',
                            'Updated product meta descriptions programmatically',
                            'Created scripts for meta description management'
                        ]
                    },
                    {
                        title: '2. Image Optimization',
                        tasks: [
                            'Reduced hero image width from 3840px to 1920px',
                            'Added loading="lazy" to 39 images',
                            'Added decoding="async" to collection/product cards',
                            'Added alt text to slideshow images',
                            'Created accessible-image.liquid snippet',
                            'Expected payload reduction: 1-2 MB'
                        ]
                    },
                    {
                        title: '3. JavaScript Optimization',
                        tasks: [
                            'Implemented conditional Swiper loading (~151 KB savings)',
                            'Implemented conditional PhotoSwipe loading (~244 KB savings)',
                            'Implemented conditional ScrollTrigger loading (~24 KB savings)',
                            'Implemented conditional noUiSlider loading (~27 KB savings)',
                            'Implemented conditional Vimeo Player loading (~37 KB savings)',
                            'Created optimized-scripts.liquid snippet',
                            'Total expected savings: 400-500 KB'
                        ]
                    },
                    {
                        title: '4. Critical Path Optimization',
                        tasks: [
                            'Added fetchpriority="high" to hero image',
                            'Added preload for Swiper CSS',
                            'Made Google Tag Manager async/deferred',
                            'Optimized render-blocking resources',
                            'Expected TBT reduction: 100-300ms'
                        ]
                    },
                    {
                        title: '5. Core Web Vitals',
                        tasks: [
                            'LCP: Targeted 2.6s ‚Üí 2.3s (below 2.5s threshold)',
                            'INP: Already excellent at 95ms',
                            'CLS: Perfect score at 0',
                            'FCP: 1.6s maintained',
                            'TTFB: 0.5s maintained'
                        ]
                    },
                    {
                        title: '6. Scripts & Automation',
                        tasks: [
                            'Created analyze_theme_performance.py',
                            'Created fix_theme_performance.py',
                            'Created fix_slideshow_fetchpriority.py',
                            'Created fix_all_images.py',
                            'Created check_core_web_vitals.py',
                            'Created check_meta_descriptions.py',
                            'Created update_product_meta_descriptions.py'
                        ]
                    },
                    {
                        title: '7. Accessibility Improvements',
                        tasks: [
                            'Added alt attributes to images',
                            'Improved heading hierarchy',
                            'Created accessible-image.liquid snippet',
                            'Expected accessibility score: 90 ‚Üí 93-95'
                        ]
                    }
                ],
                technicalDetails: [
                    { label: 'Platform', value: 'Shopify Liquid' },
                    { label: 'Tools', value: 'PageSpeed Insights' },
                    { label: 'Monitoring', value: 'Chrome UX Report' },
                    { label: 'Scripts', value: 'Python (Shopify API)' },
                    { label: 'Payload Savings', value: '~2 MB reduction' }
                ]
            }
        };

        // Load tasks from localStorage
        let allTasks = JSON.parse(localStorage.getItem('projectTasks')) || [];
        let editingTaskIndex = null;

        // Initialize
        function init() {
            renderProjects();
            updateStats();
        }

        function renderProjects() {
            const container = document.getElementById('projectsContainer');
            container.innerHTML = '';

            Object.values(projects).forEach(project => {
                const projectTasks = allTasks.filter(t => t.project === project.id);
                
                const card = document.createElement('div');
                card.className = 'project-card';
                card.innerHTML = `
                    <div class="project-header" onclick="toggleProject(this)">
                        <div class="project-title-section">
                            <div class="project-title">${project.title}</div>
                            <div class="project-meta">
                                <span class="status-badge status-${project.status}">${project.status.toUpperCase()}</span>
                                <span>üìÖ ${project.startDate} - ${project.completionDate || 'Present'}</span>
                                ${project.url ? `<span>üîó <a href="${project.url}" target="_blank" onclick="event.stopPropagation()">View Live</a></span>` : ''}
                                <span>üìù ${projectTasks.length} pending tasks</span>
                            </div>
                        </div>
                        <div class="expand-icon">‚ñº</div>
                    </div>
                    <div class="project-content">
                        <div class="project-details">
                            <p style="color: #4a5568; margin-bottom: 20px;">${project.description}</p>

                            <!-- Metrics -->
                            <div class="section">
                                <div class="section-title">üìä Key Metrics</div>
                                <div class="metrics-grid">
                                    ${Object.entries(project.metrics).map(([label, value]) => `
                                        <div class="metric-item">
                                            <div class="metric-label">${label}</div>
                                            <div class="metric-value">${value}</div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>

                            <!-- Completed Work -->
                            <div class="section">
                                <div class="section-title">‚úÖ Completed Work</div>
                                ${project.categories.map(cat => `
                                    <div class="category-group">
                                        <div class="category-title">${cat.title}</div>
                                        <ul class="task-list">
                                            ${cat.tasks.map(task => `<li>${task}</li>`).join('')}
                                        </ul>
                                    </div>
                                `).join('')}
                            </div>

                            <!-- Technical Details -->
                            ${project.technicalDetails ? `
                                <div class="section">
                                    <div class="section-title">‚öôÔ∏è Technical Stack</div>
                                    <div class="metrics-grid">
                                        ${project.technicalDetails.map(detail => `
                                            <div class="metric-item">
                                                <div class="metric-label">${detail.label}</div>
                                                <div style="color: #4a5568; font-weight: 600; margin-top: 5px;">${detail.value}</div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            ` : ''}

                            <!-- Pending Tasks -->
                            <div class="section">
                                <div class="section-title">üìã Pending Tasks (${projectTasks.length})</div>
                                ${projectTasks.length > 0 ? `
                                    ${projectTasks.map((task) => {
                                        const taskIndex = allTasks.indexOf(task);
                                        return `
                                        <div class="task-item priority-${task.priority}">
                                            <div class="task-item-header">
                                                <div class="task-item-title">${task.title}</div>
                                                <div class="task-actions">
                                                    <button class="btn btn-warning btn-small" onclick="editTask(${taskIndex})">Edit</button>
                                                    <button class="btn btn-danger btn-small" onclick="deleteTask(${taskIndex})">Delete</button>
                                                </div>
                                            </div>
                                            <div class="task-item-meta">
                                                <span class="status-badge ${task.priority === 'high' ? 'status-pending' : task.priority === 'medium' ? 'status-active' : 'status-completed'}">${task.priority.toUpperCase()}</span>
                                                ${task.category} ‚Ä¢ ${task.assignee || 'Unassigned'} ‚Ä¢ ${new Date(task.date).toLocaleDateString()}
                                            </div>
                                            <div class="task-item-description">${task.description}</div>
                                        </div>
                                    `}).join('')}
                                ` : `
                                    <div class="empty-state">
                                        <div class="empty-state-icon">‚ú®</div>
                                        <p>No pending tasks for this project</p>
                                    </div>
                                `}
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function toggleProject(header) {
            const card = header.closest('.project-card');
            card.classList.toggle('expanded');
        }

        function updateStats() {
            const activeProjects = Object.values(projects).filter(p => p.status === 'active').length;
            const completedProjects = Object.values(projects).filter(p => p.status === 'completed').length;
            
            document.getElementById('activeProjects').textContent = activeProjects;
            document.getElementById('completedProjects').textContent = completedProjects;
            document.getElementById('pendingTasks').textContent = allTasks.length;
        }

        // Modal functions
        function openTaskModal() {
            editingTaskIndex = null;
            document.getElementById('modalTitle').textContent = 'Add New Task';
            document.getElementById('submitBtn').textContent = 'Add Task';
            document.getElementById('taskForm').reset();
            document.getElementById('taskId').value = '';
            document.getElementById('taskIndex').value = '';
            document.getElementById('taskModal').classList.add('active');
        }

        function editTask(index) {
            editingTaskIndex = index;
            const task = allTasks[index];
            
            document.getElementById('modalTitle').textContent = 'Edit Task';
            document.getElementById('submitBtn').textContent = 'Save Changes';
            document.getElementById('taskId').value = task.id;
            document.getElementById('taskIndex').value = index;
            document.getElementById('taskProject').value = task.project;
            document.getElementById('taskTitle').value = task.title;
            document.getElementById('taskDescription').value = task.description;
            document.getElementById('taskPriority').value = task.priority;
            document.getElementById('taskCategory').value = task.category;
            document.getElementById('taskAssignee').value = task.assignee === 'Unassigned' ? '' : task.assignee;
            
            document.getElementById('taskModal').classList.add('active');
        }

        function closeTaskModal() {
            document.getElementById('taskModal').classList.remove('active');
            document.getElementById('taskForm').reset();
            editingTaskIndex = null;
        }

        // Form submission
        document.getElementById('taskForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const task = {
                project: document.getElementById('taskProject').value,
                title: document.getElementById('taskTitle').value,
                description: document.getElementById('taskDescription').value,
                priority: document.getElementById('taskPriority').value,
                category: document.getElementById('taskCategory').value,
                assignee: document.getElementById('taskAssignee').value || 'Unassigned',
                date: editingTaskIndex !== null ? allTasks[editingTaskIndex].date : new Date().toISOString(),
                id: editingTaskIndex !== null ? allTasks[editingTaskIndex].id : Date.now()
            };
            
            if (editingTaskIndex !== null) {
                // Update existing task
                allTasks[editingTaskIndex] = task;
                alert('‚úÖ Task updated successfully!');
            } else {
                // Add new task
                allTasks.unshift(task);
                alert('‚úÖ Task added successfully!');
            }
            
            localStorage.setItem('projectTasks', JSON.stringify(allTasks));
            
            closeTaskModal();
            renderProjects();
            updateStats();
        });

        function deleteTask(index) {
            if (confirm('Are you sure you want to delete this task?')) {
                allTasks.splice(index, 1);
                localStorage.setItem('projectTasks', JSON.stringify(allTasks));
                renderProjects();
                updateStats();
            }
        }

        function exportAllTasks() {
            if (allTasks.length === 0) {
                alert('No tasks to export');
                return;
            }
            
            const dataStr = JSON.stringify(allTasks, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `tasks-export-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }

        // Close modal on outside click
        document.getElementById('taskModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeTaskModal();
            }
        });

        // Initialize on load
        init();
    </script>
</body>
</html>
